var org;!function(t){!function(t){!function(t){!function(t){var i=BABYLON.Axis,s=BABYLON.Color3,e=BABYLON.Mesh,n=BABYLON.MeshBuilder,h=BABYLON.Quaternion,a=BABYLON.Space,r=BABYLON.StandardMaterial,o=BABYLON.Vector3,l=function(){function t(t,i,s,n){var h=this;this.local=!0,this.snapT=!1,this.snapR=!1,this.transSnap=1,this.rotSnap=Math.PI/18,this.axesLen=.4,this.axesScale=1,this.pDown=!1,this.pointerIsOver=!1,this.editing=!1,this.snapRX=0,this.snapRY=0,this.snapRZ=0,this.snapTX=0,this.snapTY=0,this.snapTZ=0,this.snapTV=new o(0,0,0),this.transBy=new o(0,0,0),this.snapS=!1,this.snapSX=0,this.snapSY=0,this.snapSZ=0,this.snapSA=0,this.snapSV=new o(0,0,0),this.scaleSnap=.25,this.scale=new o(0,0,0),this.eulerian=!1,this.snapRA=0,this.transEnabled=!1,this.rotEnabled=!1,this.scaleEnabled=!1,this.localX=new o(0,0,0),this.localY=new o(0,0,0),this.localZ=new o(0,0,0),this.distFromCamera=2,this.toParent=new o(0,0,0),this.cameraNormal=new o(0,0,0),this.mesh=t,this.canvas=s,this.axesScale=n,this.scene=t.getScene(),this.mainCamera=i,this.actHist=new d(t,10),t.computeWorldMatrix(!0),this.theParent=new e("EditControl",this.scene),this.mesh.getAbsolutePivotPointToRef(this.theParent.position),this.theParent.rotationQuaternion=t.rotationQuaternion,this.theParent.visibility=0,this.theParent.isPickable=!1,this.createMaterials(this.scene),this.createGuideAxes(),this.guideCtl.parent=this.theParent,this.createPickPlane(),this.pickPlane.parent=this.theParent,this.pointerdown=function(t){return h.onPointerDown(t)},this.pointerup=function(t){return h.onPointerUp(t)},this.pointermove=function(t){return h.onPointerMove(t)},s.addEventListener("pointerdown",this.pointerdown,!1),s.addEventListener("pointerup",this.pointerup,!1),s.addEventListener("pointermove",this.pointermove,!1),this.setLocalAxes(t),this.renderer=function(){return h.renderLoopProcess()},this.scene.registerBeforeRender(this.renderer)}return t.prototype.renderLoopProcess=function(){this.setAxesScale(),this.mesh.getAbsolutePivotPointToRef(this.theParent.position),this.onPointerOver()},t.prototype.switchTo=function(t){t.computeWorldMatrix(!0),this.mesh=t,this.theParent.rotationQuaternion=t.rotationQuaternion,this.setLocalAxes(t),this.actHist=new d(t,10)},t.prototype.setUndoCount=function(t){this.actHist.setCapacity(t)},t.prototype.undo=function(){this.actHist.undo(),this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh)},t.prototype.redo=function(){this.actHist.redo(),this.mesh.computeWorldMatrix(!0),this.setLocalAxes(this.mesh)},t.prototype.detach=function(){this.canvas.removeEventListener("pointerdown",this.pointerdown,!1),this.canvas.removeEventListener("pointerup",this.pointerup,!1),this.canvas.removeEventListener("pointermove",this.pointermove,!1),this.scene.unregisterBeforeRender(this.renderer),this.disposeAll()},t.prototype.disposeAll=function(){this.theParent.dispose(),this.disposeMaterials(),this.actHist=null},t.prototype.onPointerDown=function(t){var i=this;if(t.preventDefault(),this.pDown=!0,0==t.button){var s=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(t){if(i.transEnabled){if(t==i.tX||t==i.tY||t==i.tZ||t==i.tXZ||t==i.tZY||t==i.tYX||t==i.tAll)return!0}else if(i.rotEnabled){if(t==i.rX||t==i.rY||t==i.rZ||t==i.rAll)return!0}else if(i.scaleEnabled&&(t==i.sX||t==i.sY||t==i.sZ||t==i.sXZ||t==i.sZY||t==i.sYX||t==i.sAll))return!0;return!1},null,this.mainCamera);if(s.hit){this.setAxesVisiblity(0),this.axisPicked=s.pickedMesh;var e=this.axisPicked.getChildren();e.length>0?e[0].visibility=1:this.axisPicked.visibility=1;var n=this.axisPicked.name;"X"==n?this.bXaxis.visibility=1:"Y"==n?this.bYaxis.visibility=1:"Z"==n?this.bZaxis.visibility=1:"XZ"==n?(this.bXaxis.visibility=1,this.bZaxis.visibility=1):"ZY"==n?(this.bZaxis.visibility=1,this.bYaxis.visibility=1):"YX"==n?(this.bYaxis.visibility=1,this.bXaxis.visibility=1):"ALL"==n&&(this.bXaxis.visibility=1,this.bYaxis.visibility=1,this.bZaxis.visibility=1),this.editing=!0,this.prevPos=this.getPosOnPickPlane(),window.setTimeout(function(t,s){return i.detachControl(t,s)},0,this.mainCamera,this.canvas)}}},t.prototype.isEditing=function(){return this.editing},t.prototype.detachControl=function(t,i){var s=t,e=i;s.detachControl(e)},t.prototype.isPointerOver=function(){return this.pointerIsOver},t.prototype.onPointerOver=function(){var t=this;if(!this.pDown){var i=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(i){if(t.transEnabled){if(i==t.tX||i==t.tY||i==t.tZ||i==t.tXZ||i==t.tZY||i==t.tYX||i==t.tAll)return!0}else if(t.rotEnabled){if(i==t.rX||i==t.rY||i==t.rZ||i==t.rAll)return!0}else if(t.scaleEnabled&&(i==t.sX||i==t.sY||i==t.sZ||i==t.sXZ||i==t.sZY||i==t.sYX||i==t.sAll))return!0;return!1},null,this.mainCamera);if(i.hit){if(i.pickedMesh!=this.prevOverMesh){if(this.pointerIsOver=!0,null!=this.prevOverMesh&&(this.prevOverMesh.visibility=0,this.restoreColor(this.prevOverMesh)),this.prevOverMesh=i.pickedMesh,this.rotEnabled)this.savedCol=this.prevOverMesh.getChildren()[0].color,this.prevOverMesh.getChildren()[0].color=s.White();else{var e=this.prevOverMesh.getChildren();e.length>0?(this.savedMat=e[0].material,e[0].material=this.whiteMat):(this.savedMat=this.prevOverMesh.material,this.prevOverMesh.material=this.whiteMat)}"X"==this.prevOverMesh.name?this.xaxis.color=s.White():"Y"==this.prevOverMesh.name?this.yaxis.color=s.White():"Z"==this.prevOverMesh.name&&(this.zaxis.color=s.White())}}else this.pointerIsOver=!1,null!=this.prevOverMesh&&(this.restoreColor(this.prevOverMesh),this.prevOverMesh=null)}},t.prototype.restoreColor=function(t){switch(t.name){case"X":this.xaxis.color=s.Red();break;case"Y":this.yaxis.color=s.Green();break;case"Z":this.zaxis.color=s.Blue()}if(this.rotEnabled)t.getChildren()[0].color=this.savedCol;else{var i=t.getChildren();i.length>0?i[0].material=this.savedMat:t.material=this.savedMat}},t.prototype.restoreColor_old=function(t){var i,e;if("X"==t.name?(i=s.Red(),e=this.redMat,this.xaxis.color=s.Red()):"Y"==t.name?(i=s.Green(),e=this.greenMat,this.yaxis.color=s.Green()):"Z"==t.name?(i=s.Blue(),e=this.blueMat,this.zaxis.color=s.Blue()):(i=s.Yellow(),e=this.yellowMat),this.rotEnabled)t.getChildren()[0].color=i;else{var n=t.getChildren();n.length>0?n[0].material=e:t.material=e}},t.prototype.onPointerUp=function(t){this.pDown=!1,this.editing&&(this.mainCamera.attachControl(this.canvas),this.editing=!1,this.setAxesVisiblity(1),this.hideBaxis(),this.restoreColor(this.prevOverMesh),this.prevOverMesh=null,this.actHist.add())},t.prototype.onPointerMove=function(t){if(this.pDown&&this.editing){var i=this.getPosOnPickPlane();null!=i&&(this.transEnabled&&this.doTranslation(i),this.scaleEnabled&&this.local&&this.doScaling(i),this.rotEnabled&&this.doRotation(i),this.prevPos=i)}},t.prototype.doTranslation=function(t){var i=t.subtract(this.prevPos);0==i.x&&0==i.y&&0==i.z||(this.transBy.x=0,this.transBy.y=0,this.transBy.z=0,this.axisPicked!=this.tX&&this.axisPicked!=this.tXZ&&this.axisPicked!=this.tYX&&this.axisPicked!=this.tAll||(this.local?this.transBy.x=o.Dot(i,this.localX)/(this.localX.length()*this.mesh.scaling.x):this.transBy.x=i.x),this.axisPicked!=this.tY&&this.axisPicked!=this.tZY&&this.axisPicked!=this.tYX&&this.axisPicked!=this.tAll||(this.local?this.transBy.y=o.Dot(i,this.localY)/(this.localY.length()*this.mesh.scaling.y):this.transBy.y=i.y),this.axisPicked!=this.tZ&&this.axisPicked!=this.tXZ&&this.axisPicked!=this.tZY&&this.axisPicked!=this.tAll||(this.local?this.transBy.z=o.Dot(i,this.localZ)/(this.localZ.length()*this.mesh.scaling.z):this.transBy.z=i.z),this.transWithSnap(this.mesh,this.transBy,this.local),this.mesh.computeWorldMatrix(!0))},t.prototype.transWithSnap=function(t,i,s){var e=new o(this.transSnap,this.transSnap,this.transSnap);if(s&&(e=e.multiplyByFloats(1/t.scaling.x,1/t.scaling.y,1/t.scaling.z)),this.snapT){var n=!1;if(this.snapTV.addInPlace(i),Math.abs(this.snapTV.x)>e.x&&(i.x>0?i.x=e.x:i.x=-e.x,n=!0),Math.abs(this.snapTV.y)>e.y&&(i.y>0?i.y=e.y:i.y=-e.y,n=!0),Math.abs(this.snapTV.z)>e.z&&(i.z>0?i.z=e.z:i.z=-e.z,n=!0),!n)return;Math.abs(i.x)!==e.x&&0!==i.x&&(i.x=0),Math.abs(i.y)!==e.y&&0!==i.y&&(i.y=0),Math.abs(i.z)!==e.z&&0!==i.z&&(i.z=0),o.FromFloatsToRef(0,0,0,this.snapTV),n=!1}s?this.mesh.locallyTranslate(i):this.mesh.position.addInPlace(i)},t.prototype.doScaling=function(t){var i=t.subtract(this.prevPos);0==i.x&&0==i.y&&0==i.z||(this.scale.x=0,this.scale.y=0,this.scale.z=0,this.axisPicked!==this.sX&&this.axisPicked!==this.sXZ&&this.axisPicked!==this.sYX&&this.axisPicked!==this.sAll||(this.scale.x=o.Dot(i,this.localX)/this.localX.length()),this.axisPicked!==this.sY&&this.axisPicked!==this.sYX&&this.axisPicked!==this.sZY&&this.axisPicked!==this.sAll||(this.scale.y=o.Dot(i,this.localY)/this.localY.length()),this.axisPicked!==this.sZ&&this.axisPicked!==this.sXZ&&this.axisPicked!==this.sZY&&this.axisPicked!==this.sAll||(this.scale.z=o.Dot(i,this.localZ)/this.localZ.length()),this.scaleWithSnap(this.mesh,this.scale))},t.prototype.scaleWithSnap=function(t,i){if(this.snapS){var s=!1;if(this.snapSV.addInPlace(i),Math.abs(this.snapSV.x)>this.scaleSnap&&(i.x>0?i.x=this.scaleSnap:i.x=-this.scaleSnap,s=!0),Math.abs(this.snapSV.y)>this.scaleSnap&&(i.y>0?i.y=this.scaleSnap:i.y=-this.scaleSnap,s=!0),Math.abs(this.snapSV.z)>this.scaleSnap&&(i.z>0?i.z=this.scaleSnap:i.z=-this.scaleSnap,s=!0),!s)return;Math.abs(i.x)!==this.scaleSnap&&0!==i.x&&(i.x=0),Math.abs(i.y)!==this.scaleSnap&&0!==i.y&&(i.y=0),Math.abs(i.z)!==this.scaleSnap&&0!==i.z&&(i.z=0),o.FromFloatsToRef(0,0,0,this.snapSV),s=!1}t.scaling.addInPlace(i)},t.prototype.doRotation=function(s){var e=o.TransformNormal(i.Z,this.mainCamera.getWorldMatrix()),n=t.getAngle(this.prevPos,s,this.mesh.getAbsolutePivotPoint(),e);this.axisPicked==this.rX?(this.snapR&&(this.snapRX+=n,n=0,Math.abs(this.snapRX)>=this.rotSnap&&(n=this.snapRX>0?this.rotSnap:-this.rotSnap,this.snapRX=0)),0!==n&&(this.local?(o.Dot(this.localX,e)<0&&(n*=-1),this.mesh.rotate(i.X,n,a.LOCAL)):this.mesh.rotate(new o(e.x,0,0),n,a.WORLD))):this.axisPicked==this.rY?(this.snapR&&(this.snapRY+=n,n=0,Math.abs(this.snapRY)>=this.rotSnap&&(n=this.snapRY>0?this.rotSnap:-this.rotSnap,this.snapRY=0)),0!==n&&(this.local?(o.Dot(this.localY,e)<0&&(n*=-1),this.mesh.rotate(i.Y,n,a.LOCAL)):this.mesh.rotate(new o(0,e.y,0),n,a.WORLD))):this.axisPicked==this.rZ?(this.snapR&&(this.snapRZ+=n,n=0,Math.abs(this.snapRZ)>=this.rotSnap&&(n=this.snapRZ>0?this.rotSnap:-this.rotSnap,this.snapRZ=0)),0!==n&&(this.local?(o.Dot(this.localZ,e)<0&&(n*=-1),this.mesh.rotate(i.Z,n,a.LOCAL)):this.mesh.rotate(new o(0,0,e.z),n,a.WORLD))):this.axisPicked==this.rAll&&(this.snapR&&(this.snapRA+=n,n=0,Math.abs(this.snapRA)>=this.rotSnap&&(n=this.snapRA>0?this.rotSnap:-this.rotSnap,this.snapRA=0)),0!==n&&this.mesh.rotate(this.mesh.position.subtract(this.mainCamera.position),n,a.WORLD)),this.setLocalAxes(this.mesh),this.eulerian&&(this.mesh.rotation=this.mesh.rotationQuaternion.toEulerAngles(),this.mesh.rotationQuaternion=null)},t.prototype.getPosOnPickPlane=function(){var t=this,i=this.scene.pick(this.scene.pointerX,this.scene.pointerY,function(i){return i==t.pickPlane},null,this.mainCamera);return i.hit?i.pickedPoint:null},t.prototype.hideBaxis=function(){this.bXaxis.visibility=0,this.bYaxis.visibility=0,this.bZaxis.visibility=0},t.prototype.setAxesVisiblity=function(t){this.transEnabled&&(this.tEndX.visibility=t,this.tEndY.visibility=t,this.tEndZ.visibility=t,this.tEndXZ.visibility=t,this.tEndZY.visibility=t,this.tEndYX.visibility=t,this.tEndAll.visibility=t),this.rotEnabled&&(this.rEndX.visibility=t,this.rEndY.visibility=t,this.rEndZ.visibility=t,this.rEndAll.visibility=t),this.scaleEnabled&&(this.sEndX.visibility=t,this.sEndY.visibility=t,this.sEndZ.visibility=t,this.sEndXZ.visibility=t,this.sEndZY.visibility=t,this.sEndYX.visibility=t,this.sEndAll.visibility=t)},t.prototype.isTranslationEnabled=function(){return this.transEnabled},t.prototype.enableTranslation=function(){null==this.tX&&(this.createTransAxes(),this.tCtl.parent=this.theParent),this.transEnabled||(this.tEndX.visibility=1,this.tEndY.visibility=1,this.tEndZ.visibility=1,this.tEndXZ.visibility=1,this.tEndZY.visibility=1,this.tEndYX.visibility=1,this.tEndAll.visibility=1,this.transEnabled=!0,this.disableRotation(),this.disableScaling())},t.prototype.disableTranslation=function(){this.transEnabled&&(this.tEndX.visibility=0,this.tEndY.visibility=0,this.tEndZ.visibility=0,this.tEndXZ.visibility=0,this.tEndZY.visibility=0,this.tEndYX.visibility=0,this.tEndAll.visibility=0,this.transEnabled=!1)},t.prototype.isRotationEnabled=function(){return this.rotEnabled},t.prototype.returnEuler=function(t){this.eulerian=t},t.prototype.enableRotation=function(){null==this.rX&&(this.createRotAxes(),this.rCtl.parent=this.theParent),this.rotEnabled||(this.rEndX.visibility=1,this.rEndY.visibility=1,this.rEndZ.visibility=1,this.rEndAll.visibility=1,this.rotEnabled=!0,this.disableTranslation(),this.disableScaling())},t.prototype.disableRotation=function(){this.rotEnabled&&(this.rEndX.visibility=0,this.rEndY.visibility=0,this.rEndZ.visibility=0,this.rEndAll.visibility=0,this.rotEnabled=!1)},t.prototype.isScalingEnabled=function(){return this.scaleEnabled},t.prototype.enableScaling=function(){null==this.sX&&(this.createScaleAxes(),this.sCtl.parent=this.theParent),this.scaleEnabled||(this.sEndX.visibility=1,this.sEndY.visibility=1,this.sEndZ.visibility=1,this.sEndXZ.visibility=1,this.sEndZY.visibility=1,this.sEndYX.visibility=1,this.sEndAll.visibility=1,this.scaleEnabled=!0,this.disableTranslation(),this.disableRotation())},t.prototype.disableScaling=function(){this.scaleEnabled&&(this.sEndX.visibility=0,this.sEndY.visibility=0,this.sEndZ.visibility=0,this.sEndXZ.visibility=0,this.sEndZY.visibility=0,this.sEndYX.visibility=0,this.sEndAll.visibility=0,this.scaleEnabled=!1)},t.prototype.createGuideAxes=function(){this.guideCtl=new e("guideCtl",this.scene),this.bXaxis=e.CreateLines("bxAxis",[new o(-100,0,0),new o(100,0,0)],this.scene),this.bYaxis=e.CreateLines("byAxis",[new o(0,-100,0),new o(0,100,0)],this.scene),this.bZaxis=e.CreateLines("bzAxis",[new o(0,0,-100),new o(0,0,100)],this.scene),this.bXaxis.isPickable=!1,this.bYaxis.isPickable=!1,this.bZaxis.isPickable=!1,this.bXaxis.parent=this.guideCtl,this.bYaxis.parent=this.guideCtl,this.bZaxis.parent=this.guideCtl,this.bXaxis.color=s.Red(),this.bYaxis.color=s.Green(),this.bZaxis.color=s.Blue(),this.bXaxis.renderingGroupId=1,this.bYaxis.renderingGroupId=1,this.bZaxis.renderingGroupId=1,this.hideBaxis();var t=this.axesLen*this.axesScale;this.xaxis=e.CreateLines("xAxis",[new o(0,0,0),new o(t,0,0)],this.scene),this.yaxis=e.CreateLines("yAxis",[new o(0,0,0),new o(0,t,0)],this.scene),this.zaxis=e.CreateLines("zAxis",[new o(0,0,0),new o(0,0,t)],this.scene),this.xaxis.isPickable=!1,this.yaxis.isPickable=!1,this.zaxis.isPickable=!1,this.xaxis.parent=this.guideCtl,this.yaxis.parent=this.guideCtl,this.zaxis.parent=this.guideCtl,this.xaxis.color=s.Red(),this.yaxis.color=s.Green(),this.zaxis.color=s.Blue(),this.xaxis.renderingGroupId=2,this.yaxis.renderingGroupId=2,this.zaxis.renderingGroupId=2},t.prototype.createPickPlane=function(){this.pickPlane=e.CreatePlane("axisPlane",200,this.scene),this.pickPlane.isPickable=!1,this.pickPlane.visibility=0,this.pickPlane.billboardMode=e.BILLBOARDMODE_ALL,this.pickPlane.renderingGroupId=1},t.prototype.createTransAxes=function(){var t=.04*this.axesScale,i=this.axesLen*this.axesScale;this.tCtl=new e("tarnsCtl",this.scene),this.tX=this.extrudeBox(t/2,i),this.tX.name="X",this.tY=this.tX.clone("Y"),this.tZ=this.tX.clone("Z"),this.tXZ=n.CreatePlane("XZ",{size:2*t},this.scene),this.tZY=this.tXZ.clone("ZY"),this.tYX=this.tXZ.clone("YX"),this.tXZ.rotation.x=1.57,this.tZY.rotation.y=1.57,this.tXZ.position.x=t,this.tXZ.position.z=t,this.tZY.position.z=t,this.tZY.position.y=t,this.tYX.position.y=t,this.tYX.position.x=t,this.tAll=e.CreateBox("ALL",2*t,this.scene),this.tX.parent=this.tCtl,this.tY.parent=this.tCtl,this.tZ.parent=this.tCtl,this.tXZ.parent=this.tCtl,this.tZY.parent=this.tCtl,this.tYX.parent=this.tCtl,this.tAll.parent=this.tCtl,this.tX.rotation.y=1.57,this.tY.rotation.x-=1.57,this.tX.visibility=0,this.tY.visibility=0,this.tZ.visibility=0,this.tXZ.visibility=0,this.tZY.visibility=0,this.tYX.visibility=0,this.tAll.visibility=0,this.tX.renderingGroupId=1,this.tY.renderingGroupId=1,this.tZ.renderingGroupId=1,this.tXZ.renderingGroupId=1,this.tZY.renderingGroupId=1,this.tYX.renderingGroupId=1,this.tAll.renderingGroupId=1,this.tX.isPickable=!1,this.tY.isPickable=!1,this.tZ.isPickable=!1,this.tXZ.isPickable=!1,this.tZY.isPickable=!1,this.tYX.isPickable=!1,this.tAll.isPickable=!1;var s=i/5,h=t;this.tEndX=e.CreateCylinder("tEndX",s,0,h,6,1,this.scene),this.tEndY=this.tEndX.clone("tEndY"),this.tEndZ=this.tEndX.clone("tEndZ"),this.tEndXZ=n.CreatePlane("XZ",{size:1.75*h,sideOrientation:e.DOUBLESIDE},this.scene),this.tEndZY=this.tEndXZ.clone("ZY"),this.tEndYX=this.tEndXZ.clone("YX"),this.tEndAll=e.CreateBox("tEndAll",h,this.scene),this.tEndX.rotation.x=1.57,this.tEndY.rotation.x=1.57,this.tEndZ.rotation.x=1.57,this.tEndX.parent=this.tX,this.tEndY.parent=this.tY,this.tEndZ.parent=this.tZ,this.tEndXZ.parent=this.tXZ,this.tEndZY.parent=this.tZY,this.tEndYX.parent=this.tYX,this.tEndAll.parent=this.tAll,this.tEndX.position.z=i-s/2,this.tEndY.position.z=i-s/2,this.tEndZ.position.z=i-s/2,this.tEndX.material=this.redMat,this.tEndY.material=this.greenMat,this.tEndZ.material=this.blueMat,this.tEndXZ.material=this.redMat,this.tEndZY.material=this.blueMat,this.tEndYX.material=this.greenMat,this.tEndAll.material=this.yellowMat,this.tEndX.renderingGroupId=1,this.tEndY.renderingGroupId=1,this.tEndZ.renderingGroupId=1,this.tEndXZ.renderingGroupId=1,this.tEndZY.renderingGroupId=1,this.tEndYX.renderingGroupId=1,this.tEndAll.renderingGroupId=1,this.tEndX.isPickable=!1,this.tEndY.isPickable=!1,this.tEndZ.isPickable=!1,this.tEndXZ.isPickable=!1,this.tEndZY.isPickable=!1,this.tEndYX.isPickable=!1,this.tEndAll.isPickable=!1},t.prototype.createRotAxes=function(){var t=this.axesLen*this.axesScale*2;this.rCtl=new e("rotCtl",this.scene),this.rX=this.createTube(t/2,90),this.rX.name="X",this.rY=this.rX.clone("Y"),this.rZ=this.rX.clone("Z"),this.rAll=this.createTube(t/1.75,360),this.rAll.name="ALL",this.rX.parent=this.rCtl,this.rY.parent=this.rCtl,this.rZ.parent=this.rCtl,this.rAll.parent=this.pickPlane,this.rX.rotation.z=1.57,this.rZ.rotation.x=-1.57,this.rAll.rotation.x=1.57,this.rX.visibility=0,this.rY.visibility=0,this.rZ.visibility=0,this.rAll.visibility=0,this.rX.renderingGroupId=1,this.rY.renderingGroupId=1,this.rZ.renderingGroupId=1,this.rAll.renderingGroupId=1,this.rX.isPickable=!1,this.rY.isPickable=!1,this.rZ.isPickable=!1,this.rAll.isPickable=!1;var i=t;this.rEndX=this.createCircle(i/2,90),this.rEndY=this.rEndX.clone(""),this.rEndZ=this.rEndX.clone(""),this.rEndAll=this.createCircle(i/1.75,360),this.rEndX.parent=this.rX,this.rEndY.parent=this.rY,this.rEndZ.parent=this.rZ,this.rEndAll.parent=this.rAll,this.rEndX.color=s.Red(),this.rEndY.color=s.Green(),this.rEndZ.color=s.Blue(),this.rEndAll.color=s.Yellow(),this.rEndX.renderingGroupId=1,this.rEndY.renderingGroupId=1,this.rEndZ.renderingGroupId=1,this.rEndAll.renderingGroupId=1,this.rEndX.isPickable=!1,this.rEndY.isPickable=!1,this.rEndZ.isPickable=!1,this.rEndAll.isPickable=!1},t.prototype.extrudeBox=function(t,i){var s=[new o(t,t,0),new o(-t,t,0),new o(-t,-t,0),new o(t,-t,0),new o(t,t,0)],n=[new o(0,0,0),new o(0,0,i)];return e.ExtrudeShape("",s,n,1,0,2,this.scene)},t.prototype.createCircle=function(t,i){null===i&&(i=360);for(var s,n,h=[],a=3.14/180,r=0,l=0;l<=i;l+=10)s=t*Math.cos(l*a),n=90==l?t:270==l?-t:t*Math.sin(l*a),h[r]=new o(s,0,n),r++;return e.CreateLines("",h,this.scene)},t.prototype.createTube=function(t,i){null===i&&(i=360);for(var s,n,h=[],a=3.14/180,r=0,l=0;l<=i;l+=30)s=t*Math.cos(l*a),n=90==l?t:270==l?-t:t*Math.sin(l*a),h[r]=new o(s,0,n),r++;return e.CreateTube("",h,.02,3,null,BABYLON.Mesh.NO_CAP,this.scene)},t.prototype.createScaleAxes=function(){var t=.04*this.axesScale,i=this.axesLen*this.axesScale;this.sCtl=new e("sCtl",this.scene),this.sX=this.extrudeBox(t/2,i),this.sX.name="X",this.sY=this.sX.clone("Y"),this.sZ=this.sX.clone("Z"),this.sXZ=n.CreatePlane("XZ",{size:2*t},this.scene),this.sZY=this.sXZ.clone("ZY"),this.sYX=this.sXZ.clone("YX"),this.sXZ.rotation.x=1.57,this.sZY.rotation.y=1.57,this.sXZ.position.x=t,this.sXZ.position.z=t,this.sZY.position.z=t,this.sZY.position.y=t,this.sYX.position.y=t,this.sYX.position.x=t,this.sAll=e.CreateBox("ALL",2*t,this.scene),this.sX.material=this.redMat,this.sY.material=this.greenMat,this.sZ.material=this.blueMat,this.sAll.material=this.yellowMat,this.sX.parent=this.sCtl,this.sY.parent=this.sCtl,this.sZ.parent=this.sCtl,this.sAll.parent=this.sCtl,this.sXZ.parent=this.sCtl,this.sZY.parent=this.sCtl,this.sYX.parent=this.sCtl,this.sX.rotation.y=1.57,this.sY.rotation.x-=1.57,this.sX.visibility=0,this.sY.visibility=0,this.sZ.visibility=0,this.sXZ.visibility=0,this.sZY.visibility=0,this.sYX.visibility=0,this.sAll.visibility=0,this.sX.renderingGroupId=1,this.sY.renderingGroupId=1,this.sZ.renderingGroupId=1,this.sXZ.renderingGroupId=1,this.sZY.renderingGroupId=1,this.sYX.renderingGroupId=1,this.sAll.renderingGroupId=1,this.sX.isPickable=!1,this.sY.isPickable=!1,this.sZ.isPickable=!1,this.sXZ.isPickable=!1,this.sZY.isPickable=!1,this.sYX.isPickable=!1,this.sAll.isPickable=!1;var s=t;this.sEndX=e.CreateBox("",s,this.scene),this.sEndY=this.sEndX.clone(""),this.sEndZ=this.sEndX.clone(""),this.sEndAll=this.sEndX.clone(""),this.sEndXZ=n.CreatePlane("XZ",{size:1.75*s,sideOrientation:e.DOUBLESIDE},this.scene),this.sEndZY=this.sEndXZ.clone("ZY"),this.sEndYX=this.sEndXZ.clone("YX"),this.sEndX.parent=this.sX,this.sEndY.parent=this.sY,this.sEndZ.parent=this.sZ,this.sEndXZ.parent=this.sXZ,this.sEndZY.parent=this.sZY,this.sEndYX.parent=this.sYX,this.sEndAll.parent=this.sAll,this.sEndX.position.z=i-s/2,this.sEndY.position.z=i-s/2,this.sEndZ.position.z=i-s/2,this.sEndX.material=this.redMat,this.sEndY.material=this.greenMat,this.sEndZ.material=this.blueMat,this.sEndXZ.material=this.redMat,this.sEndZY.material=this.blueMat,this.sEndYX.material=this.greenMat,this.sEndAll.material=this.yellowMat,this.sEndX.renderingGroupId=1,this.sEndY.renderingGroupId=1,this.sEndZ.renderingGroupId=1,this.sEndXZ.renderingGroupId=1,this.sEndZY.renderingGroupId=1,this.sEndYX.renderingGroupId=1,this.sEndAll.renderingGroupId=1,this.sEndX.isPickable=!1,this.sEndY.isPickable=!1,this.sEndZ.isPickable=!1,this.sEndXZ.isPickable=!1,this.sEndZY.isPickable=!1,this.sEndYX.isPickable=!1,this.sEndAll.isPickable=!1},t.prototype.setLocalAxes=function(t){var i=t.getWorldMatrix();o.FromFloatArrayToRef(i.asArray(),0,this.localX),o.FromFloatArrayToRef(i.asArray(),4,this.localY),o.FromFloatArrayToRef(i.asArray(),8,this.localZ)},t.prototype.setLocal=function(t){this.local!=t&&(this.local=t,this.local?this.theParent.rotationQuaternion=this.mesh.rotationQuaternion:this.theParent.rotationQuaternion=h.Identity())},t.prototype.isLocal=function(){return this.local},t.prototype.setTransSnap=function(t){this.snapT=t},t.prototype.setRotSnap=function(t){this.snapR=t},t.prototype.setScaleSnap=function(t){this.snapS=t},t.prototype.setTransSnapValue=function(t){this.transSnap=t},t.prototype.setRotSnapValue=function(t){this.rotSnap=t},t.prototype.setScaleSnapValue=function(t){this.scaleSnap=t},t.prototype.setAxesScale=function(){this.theParent.position.subtractToRef(this.mainCamera.position,this.toParent),o.FromFloatArrayToRef(this.mainCamera.getWorldMatrix().asArray(),8,this.cameraNormal);var t=o.Dot(this.toParent,this.cameraNormal)/this.cameraNormal.length(),i=t/this.distFromCamera;o.FromFloatsToRef(i,i,i,this.theParent.scaling),o.FromFloatsToRef(i,i,i,this.pickPlane.scaling)},t.getAngle=function(t,i,s,e){var n=t.subtract(s),h=i.subtract(s),a=o.Cross(n,h),r=Math.asin(a.length()/(n.length()*h.length()));return o.Dot(a,e)<0&&(r*=-1),r},t.prototype.createMaterials=function(i){this.redMat=t.getStandardMaterial("redMat",s.Red(),i),this.greenMat=t.getStandardMaterial("greenMat",s.Green(),i),this.blueMat=t.getStandardMaterial("blueMat",s.Blue(),i),this.whiteMat=t.getStandardMaterial("whiteMat",s.White(),i),this.yellowMat=t.getStandardMaterial("whiteMat",s.Yellow(),i)},t.prototype.disposeMaterials=function(){this.redMat.dispose(),this.greenMat.dispose(),this.blueMat.dispose(),this.whiteMat.dispose(),this.yellowMat.dispose()},t.getStandardMaterial=function(t,i,e){var n=new r(t,e);return n.emissiveColor=i,n.diffuseColor=s.Black(),n.specularColor=s.Black(),n},t}();t.EditControl=l;var d=function(){function t(t,i){this.lastMax=10,this.acts=new Array,this.last=-1,this.current=-1,this.mesh=t,this.lastMax=i-1,null==t.rotationQuaternion&&null!=t.rotation&&(t.rotationQuaternion=h.RotationYawPitchRoll(t.rotation.y,t.rotation.x,t.rotation.z)),this.add()}return t.prototype.setCapacity=function(t){if(0==t)return void console.error("capacity should be more than zero");this.lastMax=t-1,this.last=-1,this.current=-1,this.acts=new Array,this.add()},t.prototype.add=function(){var t=new c(this.mesh);this.current<this.last&&(this.acts.splice(this.current+1),this.last=this.current),this.last==this.lastMax?(this.acts.shift(),this.acts.push(t)):(this.acts.push(t),this.last++,this.current++)},t.prototype.undo=function(){this.current>0&&(this.current--,this.acts[this.current].perform(this.mesh))},t.prototype.redo=function(){this.current<this.last&&(this.current++,this.acts[this.current].perform(this.mesh))},t}();t.ActHist=d;var c=function(){function t(t){this.p=t.position.clone(),null==t.rotationQuaternion?(this.r=null,this.rE=t.rotation.clone()):(this.r=t.rotationQuaternion.clone(),this.rE=null),this.s=t.scaling.clone()}return t.prototype.perform=function(t){t.position=this.p.clone(),null==t.rotationQuaternion?null!=this.rE?t.rotation=this.rE.clone():t.rotation=this.r.toEulerAngles():null!=this.r?t.rotationQuaternion=this.r.clone():t.rotationQuaternion=this.rE.toQuaternion(),t.scaling=this.s.clone()},t}();t.Act=c}(t.component||(t.component={}))}(t.babylonjs||(t.babylonjs={}))}(t.ssatguru||(t.ssatguru={}))}(org||(org={}));